<!DOCTYPE html>
<html>
<head>
  <title>Geolocation App</title>
</head>
<body>
  <h2>Geolocation Finder</h2>
  <button onclick="getLocation()">Get Location and Send to Google Sheets</button>
  <div id="output">
    <p><strong>Latitude:</strong> <span id="latitude">N/A</span></p>
    <p><strong>Longitude:</strong> <span id="longitude">N/A</span></p>
    <p><strong>Distance to Tyndall::</strong> <span id="distance">N/A</span></p>
  </div>

  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // Display the latitude and longitude in the UI
            document.getElementById('latitude').textContent = latitude;
            document.getElementById('longitude').textContent = longitude;
            document.getElementById('distance').textContent = haversine_distance(51.898046,latitude,-8.483321,longitude);

            // Send data to the Google Sheets endpoint
            sendToSheet(latitude, longitude);
          },
          function (error) {
            alert('Error obtaining location: ' + error.message);
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function hav (x) {
        return Math.sin(x/2)*Math.sin(x/2);
    }
      
    function haversine_distance (lat1,lat2,lon1,lon2)
    {
      x = hav(0.0174533*(lat2-lat1)) + Math.cos(0.0174533*lat1)*Math.cos(0.0174533*lat2)*hav(0.0174533*(lon2-lon1));
      d = 2*6.3781e+6*Math.asin(Math.sqrt(x))
      return d;
    }
    
    function sendToSheet(latitude, longitude) {
      fetch('https://script.google.com/macros/s/AKfycbzMceemf3esbAl7KqpRcnrlc4K0fACTlEIfFescPTG6eqwPgGHhZTVhnYKE4CTHBBcy/exec', {
        redirect: "follow",
        method: 'POST',
        body: JSON.stringify({ latitude, longitude }),
        headers: {
        "Content-Type": "text/plain;charset=utf-8",
      },
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          alert("Data sent successfully!");
        } else {
          alert("Error sending data: " + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error sending data: ' + error.message);
      });
    }
  </script>
</body>
</html>
